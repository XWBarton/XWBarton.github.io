<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HexCoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, serif;
      text-align: center;
      background: #f5f5f5;
      padding: 1.5rem;
      margin: 0;
    }

    h1 {
      font-family: monospace;
      font-size: clamp(2rem, 8vw, 3rem);
      margin: 0.25rem 0;
    }

    i {
      display: block;
      margin-bottom: 1rem;
    }

    .swatches {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .box {
      width: min(40vw, 160px);
      height: min(40vw, 160px);
      border-radius: 12px;
      border: 2px solid #ccc;
    }

    p {
      margin: 0.5rem 0 0;
    }

    form {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    input {
      font-size: 16px;
      padding: 0.5rem;
      width: min(60vw, 180px);
      text-transform: uppercase;
    }

    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      touch-action: manipulation;
    }

    #answer,
    #feedback,
    #score {
      margin-top: 0.5rem;
      font-family: monospace;
      padding: 0 1rem;
    }

    a {
      display: block;
      margin-top: 10vh;
    }
  </style>
</head>
<body>

  <h1>HexCoder</h1>
  <i>A hexcode colour trainer</i>

  <div class="swatches">
    <div>
      <div id="target" class="box"></div>
      <p>Target</p>
    </div>
    <div>
      <div id="guessBox" class="box"></div>
      <p>Your guess</p>
    </div>
  </div>

  <form onsubmit="check(); return false;">
    <input id="guess" placeholder="#RRGGBB" maxlength="7">
    <button type="submit">Check</button>
    <button type="button" onclick="newRound()">Next</button>
  </form>

  <div id="answer"></div>
  <div id="feedback"></div>
  <div id="score"></div>

  <a href="hexcode.html">Learn Hexcode</a>

  <script>
    let targetHex = '';

    function randomHex() {
      return '#' + Math.floor(Math.random() * 16777215)
        .toString(16)
        .padStart(6, '0')
        .toUpperCase();
    }

    function hexToRgb(hex) {
      const n = parseInt(hex.slice(1), 16);
      return {
        r: (n >> 16) & 255,
        g: (n >> 8) & 255,
        b: n & 255
      };
    }

    function colourDistance(a, b) {
      return Math.round(Math.sqrt(
        Math.pow(a.r - b.r, 2) +
        Math.pow(a.g - b.g, 2) +
        Math.pow(a.b - b.b, 2)
      ));
    }

    function check() {
      const input = document.getElementById('guess').value.toUpperCase();

      if (!/^#[0-9A-F]{6}$/.test(input)) {
        document.getElementById('feedback').textContent =
          '‚ùå Please enter a valid hex code (#RRGGBB)';
        return;
      }

      const targetRGB = hexToRgb(targetHex);
      const guessRGB = hexToRgb(input);

      const distance = colourDistance(targetRGB, guessRGB);
      const accuracy = Math.max(0, 100 - Math.round((distance / 441) * 100));

      document.getElementById('guessBox').style.background = input;
      document.getElementById('feedback').textContent =
        distance === 0 ? 'üéØ Perfect match!' : 'Nice try!';
      document.getElementById('score').textContent =
        `Distance: ${distance} / 441 ‚Äî Accuracy: ${accuracy}%`;
      document.getElementById('answer').textContent =
        `Target colour: ${targetHex}`;
    }

    function newRound() {
      targetHex = randomHex();
      document.getElementById('target').style.background = targetHex;
      document.getElementById('guessBox').style.background = '#FFFFFF';
      document.getElementById('guess').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('score').textContent = '';
      document.getElementById('answer').textContent = '';
      document.getElementById('guess').focus();
    }

    newRound();
  </script>

</body>
</html>
